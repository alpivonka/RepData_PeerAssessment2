---
title: "xxx"
author: "AWP"
date: "Thursday, July 23, 2015"
output: html_document
---


##Synopsis


##Data Processing
```{r download_data_and_load_data}

library(dplyr)
#download data if not already downloaded
if(!file.exists("FStormData.csv.bz2")){
  url<-"http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
  download.file(url, dest="FStormData.csv.bz2", mode="wb") 
  #read in the data from the compresed file
  
}
#We save the raw data to disk as rds, check if it exists, if not create it.
if (!file.exists("raw_data.rds")){
   rawData <- read.csv("FStormData.csv.bz2")
  
  #Convert EVTTYPT to all upper-case and add a new column called EVENTTYPE
  rawData$EVENTTYPE<-toupper(rawData$EVTYPE)
  
  #Narrow our focus
  rawNarrowed<-subset(rawData,select=c(EVENTTYPE,BGN_DATE,MAG,FATALITIES,INJURIES,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP,WFO))
  rawNarrowed<-mutate(rawNarrowed, date = parse_date_time(BGN_DATE,"%m/%d/%y %H%M%S"),YEAR = year(date))
  
  #save off the data to a rds format
  saveRDS(rawNarrowed,"raw_data.rds")
  rawData<-rawNarrowed
  rm(rawNarrowed)
}else{
 
  rawData<-readRDS("raw_data.rds")
}
```


##Analysis
```{r initial_analysis}
#Get counts of complete and incomplete data sets
incompleteRows<-sum(!complete.cases(rawData))
completeRows<-sum(complete.cases(rawData))

require(plyr); 
require(lubridate)
library(dplyr)
library(pander)
```

The raw data has `r format(incompleteRows,big.mark=",",scientific=FALSE)` incomplete rows and `r completeRows` complete rows. Elminiation of incomplete rows is not possilbe at this point and time.


Due to the only event data being recorded between 1950 and 1954 is Tornato, we are going to elimnate this data from the data set to eliminate offsets.


```{r show_eventsbyYear,results="asis"}
#this is the code which supports our decision to remove data from 1950 - 1954.
eventType_dates<-subset(rawData,select=c(EVENTTYPE,YEAR)) 
numEventsByYear<-eventType_dates %>% group_by(EVENTTYPE,YEAR) %>% tally()

#panderOptions("table.style", "simple")
#tornatoTable<-pander(head(numEventsByYear[with(numEventsByYear, order(YEAR)),],10))
```



```{r remove_years}

#add the year (want to eliminate all data between 1950-1954 because they only recored one Event type during that time)
rawNarrowed<-subset(rawData, !(rawData$YEAR %in% c("1950","1951","1952","1953","1954")),select=c(EVENTTYPE,MAG,FATALITIES,INJURIES,PROPDMG,PROPDMGEXP,CROPDMG,CROPDMGEXP,WFO))

```


##Results
```{r}
INJURIES<-rawNarrowed %>% group_by(EVENTTYPE) %>% summarise_each(funs(sum),vars=c(-MAG,-WFO,-PROPDMGEXP,-PROPDMG,-CROPDMG,-CROPDMGEXP))
INJURIES$INJ_FAT<-INJURIES$FATALITIES + INJURIES$INJURIES
top_10<-INJURIES %>%  top_n(n=5)

maxx<-top_10[which.max(top_10$INJ_FAT),]

```

    1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
    
    As the graph below indicates, `r format(maxx$EVENTTYPE, big.mark=",", scientific=FALSE)` is the eventtype which effects population health the most with a total number of fatalities (`r format(maxx$FATALITIES, big.mark=",", scientific=FALSE)`) and injuries  (`r format(maxx$INJURIES, big.mark=",", scientific=FALSE)`) equal to `r format(maxx$INJ_FAT, big.mark=",", scientific=FALSE)`.

```{r question_one_results}


#panderOptions("table.style", "simple")
#answ2Q1Table<-pander(head(top_10[with(top_10, order(-INJ_FAT)),],10))


library(ggplot2)
ggplot(data=top_10, aes(x=EVENTTYPE, y=INJ_FAT)) +geom_bar(stat="identity")+theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5))
```

